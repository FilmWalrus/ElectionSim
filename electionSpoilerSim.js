// State info: Name, Electoral Votes, Democrat Odds, Republic Odds, Libertarian Odds, Green Odds 

// 1912 Election - Progressive
var stateInfo1912 = [["Alabama",12,69.89,8.31,19.23],["Arizona",3,43.52,12.74,29.29],["Arkansas",9,55.01,20.45,17.3],["California",13,41.81,0.58,41.83],["Colorado",6,42.8,21.88,27.09],["Connecticut",7,39.16,35.88,17.92],["Delaware",3,46.48,32.85,18.25],["Florida",6,69.52,8.42,8.96],["Georgia",14,76.63,4.27,18.1],["Idaho",4,32.08,31.02,24.14],["Illinois",29,35.34,22.13,33.72],["Indiana",15,43.07,23.11,24.75],["Iowa",13,37.64,24.33,32.87],["Kansas",10,39.3,20.47,32.88],["Kentucky",13,48.48,25.52,22.48],["Louisiana",10,76.81,4.84,11.71],["Maine",6,39.43,20.48,37.41],["Maryland",8,48.57,23.69,24.91],["Massachusetts",18,35.53,31.95,29.14],["Michigan",15,27.36,27.63,38.95],["Minnesota",12,31.84,19.25,37.66],["Mississippi",10,88.9,2.42,5.5],["Missouri",18,47.35,29.75,17.8],["Montana",4,35,23.19,28.13],["Nebraska",8,43.69,21.74,29.13],["Nevada",3,39.7,15.89,27.94],["New Hampshire",4,39.48,37.43,20.23],["New Jersey",14,41.2,20.53,33.6],["New Mexico",3,41.39,35.91,16.9],["New York",45,41.27,28.68,24.56],["North Carolina",12,59.24,11.95,28.36],["North Dakota",5,34.14,26.67,29.71],["Ohio",24,40.96,26.82,22.16],["Oklahoma",10,46.95,35.77,0.0],["Oregon",5,34.34,25.3,27.44],["Pennsylvania",38,32.49,22.45,36.53],["Rhode Island",5,39.04,35.56,21.67],["South Carolina",9,95.94,1.06,2.57],["South Dakota",5,42.07,0.0,50.56],["Tennessee",12,52.8,24,21.45],["Texas",20,72.62,8.77,9.46],["Utah",4,32.55,37.46,21.51],["Vermont",4,24.43,37.13,35.22],["Virginia",12,65.95,17,15.9],["Washington",7,26.9,21.82,35.22],["West Virginia",8,42.11,21.11,29.43],["Wisconsin",13,41.06,32.65,15.61],["Wyoming",3,36.2,34.42,21.83]];

// 1968 Election - American Independent
var stateInfo1968 = [["Alabama",10,18.72,13.99,65.86],["Alaska",3,42.65,45.28,12.07],["Arizona",5,35.02,54.78,9.56],["Arkansas",6,30.33,31.01,38.65],["California",40,44.74,47.82,6.72],["Colorado",6,41.32,50.46,7.5],["Connecticut",8,49.48,44.32,6.1],["Delaware",3,41.61,45.12,13.28],["D.C.",3,81.82,18.18,0],["Florida",14,30.93,40.53,28.53],["Georgia",12,26.75,30.4,42.83],["Hawaii",4,59.83,38.7,1.47],["Idaho",4,30.66,56.79,12.55],["Illinois",26,44.15,47.08,8.46],["Indiana",13,37.99,50.29,11.45],["Iowa",9,40.82,53.01,5.69],["Kansas",7,34.72,54.84,10.19],["Kentucky",9,37.65,43.79,18.29],["Louisiana",10,28.21,23.47,48.32],["Maine",4,55.3,43.07,1.62],["Maryland",10,43.59,41.94,14.47],["Massachusetts",14,63.01,32.89,3.73],["Michigan",21,48.18,41.46,10.04],["Minnesota",10,54,41.46,4.34],["Mississippi",7,23.02,13.52,63.46],["Missouri",12,43.74,44.87,11.39],["Montana",4,41.59,50.6,7.29],["Nebraska",5,31.81,59.82,8.36],["Nevada",3,39.29,47.46,13.25],["New Hampshire",4,43.93,52.1,3.76],["New Jersey",17,43.97,46.1,9.12],["New Mexico",4,39.75,51.85,7.86],["New York",43,49.76,44.3,5.29],["North Carolina",13,29.24,39.51,31.26],["North Dakota",4,38.23,55.94,5.75],["Ohio",26,42.95,45.23,11.81],["Oklahoma",8,31.99,47.68,20.33],["Oregon",6,43.78,49.83,6.06],["Pennsylvania",29,47.59,44.02,7.97],["Rhode Island",4,64.03,31.78,4.07],["South Carolina",8,29.61,38.09,32.3],["South Dakota",4,41.96,53.27,4.76],["Tennessee",11,28.13,37.85,34.02],["Texas",25,41.14,39.87,18.97],["Utah",4,37.07,56.49,6.37],["Vermont",3,43.53,52.75,3.16],["Virginia",12,32.49,43.36,23.64],["Washington",9,47.23,45.12,7.44],["West Virginia",7,49.6,40.78,9.62],["Wisconsin",12,44.27,47.89,7.56],["Wyoming",3,35.51,55.76,8.73]];

// 1984 Election - Independent
var stateInfo1980 = [["Alabama",9,47.45,48.75,1.23],["Alaska",3,26.41,54.35,7.04],["Arizona",6,28.24,60.61,8.81],["Arkansas",6,47.52,48.13,2.68],["California",45,35.91,52.69,8.62],["Colorado",7,31.07,55.07,11.03],["Connecticut",8,38.52,48.16,12.22],["Delaware",3,44.87,47.21,6.91],["D.C.",3,74.89,13.41,9.28],["Florida",17,38.5,55.52,5.14],["Georgia",12,55.76,40.95,2.26],["Hawaii",4,44.8,42.9,10.56],["Idaho",4,25.19,66.46,6.19],["Illinois",26,41.72,49.65,7.3],["Indiana",13,37.65,56.01,4.98],["Iowa",8,38.6,51.31,8.78],["Kansas",7,33.29,57.85,6.96],["Kentucky",9,47.61,49.07,2.4],["Louisiana",10,45.75,51.2,1.7],["Maine",4,42.25,45.61,10.2],["Maryland",10,47.14,44.18,7.76],["Massachusetts",14,41.75,41.9,15.15],["Michigan",21,42.5,48.99,7.04],["Minnesota",10,46.5,42.56,8.53],["Mississippi",7,48.09,49.42,1.35],["Missouri",12,44.35,51.16,3.71],["Montana",4,32.43,56.82,8.05],["Nebraska",5,26.04,65.53,7.02],["Nevada",3,26.89,62.54,7.12],["New Hampshire",4,28.35,57.74,12.94],["New Jersey",17,38.56,51.97,7.88],["New Mexico",4,36.78,54.97,6.46],["New York",41,43.99,46.66,7.54],["North Carolina",13,47.18,49.3,2.85],["North Dakota",3,26.26,64.23,7.84],["Ohio",25,40.91,51.51,5.94],["Oklahoma",8,34.97,60.5,3.33],["Oregon",6,38.67,48.33,9.51],["Pennsylvania",27,42.48,49.59,6.42],["Rhode Island",4,47.67,37.2,14.38],["South Carolina",8,48.04,49.57,1.59],["South Dakota",4,31.69,60.53,6.54],["Tennessee",10,48.41,48.7,2.22],["Texas",26,41.42,55.28,2.46],["Utah",4,20.57,72.77,5.01],["Vermont",3,38.41,44.37,14.9],["Virginia",12,40.31,53.03,5.11],["Washington",9,37.32,49.66,10.62],["West Virginia",6,49.81,45.3,4.3],["Wisconsin",11,43.18,47.9,7.07],["Wyoming",3,27.97,62.64,6.83]];

// 1992 Election - Independent
var stateInfo1992 = [["Alabama",9,40.88,47.65,10.85],["Alaska",3,30.29,39.46,28.43],["Arizona",8,36.52,38.47,23.79],["Arkansas",6,53.21,35.48,10.43],["California",54,46.01,32.61,20.63],["Colorado",8,40.13,35.87,23.32],["Connecticut",8,42.21,35.78,21.58],["Delaware",3,43.52,35.78,20.45],["D.C.",3,84.64,9.1,4.25],["Florida",25,39,40.89,19.82],["Georgia",13,43.47,42.88,13.34],["Hawaii",4,48.09,36.7,14.22],["Idaho",4,28.42,42.03,27.05],["Illinois",22,48.58,34.34,16.64],["Indiana",12,36.79,42.91,19.77],["Iowa",7,43.29,37.27,18.71],["Kansas",6,33.74,38.88,26.99],["Kentucky",8,44.55,41.34,13.66],["Louisiana",9,45.58,40.97,11.81],["Maine",4,38.77,30.39,30.44],["Maryland",10,49.8,35.62,14.18],["Massachusetts",12,47.54,29.03,22.8],["Michigan",18,43.77,36.38,19.3],["Minnesota",10,43.48,31.85,23.96],["Mississippi",7,40.77,49.68,8.72],["Missouri",11,44.07,33.92,21.69],["Montana",3,37.63,35.12,26.12],["Nebraska",5,29.4,46.58,23.63],["Nevada",4,37.36,34.73,26.19],["New Hampshire",4,38.91,37.69,22.59],["New Jersey",15,42.95,40.58,15.61],["New Mexico",5,45.9,37.34,16.12],["New York",33,49.73,33.88,15.75],["North Carolina",14,42.65,43.44,13.7],["North Dakota",3,32.18,44.22,23.07],["Ohio",21,40.18,38.35,20.98],["Oklahoma",8,34.02,42.65,23.01],["Oregon",7,42.48,32.53,24.21],["Pennsylvania",23,45.15,36.13,18.2],["Rhode Island",4,47.04,29.02,23.16],["South Carolina",8,39.88,48.02,11.55],["South Dakota",3,37.14,40.66,21.8],["Tennessee",11,47.08,42.43,10.09],["Texas",32,37.08,40.56,22.01],["Utah",5,24.65,43.36,27.34],["Vermont",3,46.11,30.42,22.78],["Virginia",13,40.59,44.97,13.63],["Washington",11,43.41,31.97,23.68],["West Virginia",5,48.41,35.39,15.91],["Wisconsin",11,41.13,36.78,21.51],["Wyoming",3,34.1,39.7,25.65]];

// 2000 Election - Green
var stateInfo2000 = [["Alabama",9,41.57,56.48,1.10],["Alaska",3,27.67,58.62,10.07],["Arizona",8,44.73,51.02,2.98],["Arkansas",6,45.86,51.31,1.46],["California",54,53.45,41.65,3.82],["Colorado",8,42.39,50.75,5.25],["Connecticut",8,55.91,38.44,4.42],["Delaware",3,54.96,41.90,2.54],["D.C.",3,85.16,8.95,5.24],["Florida",25,48.84,48.85,1.63],["Georgia",13,42.98,54.67,0.52],["Hawaii",4,55.79,37.46,5.88],["Idaho",4,27.64,67.17,2.45],["Illinois",22,54.60,42.58,2.19],["Indiana",12,41.01,56.65,0.84],["Iowa",7,48.54,48.22,2.23],["Kansas",6,37.24,58.04,3.37],["Kentucky",8,41.37,56.50,1.50],["Louisiana",9,44.88,52.55,1.16],["Maine",4,49.09,43.97,5.70],["Maryland",10,56.57,40.18,2.65],["Massachusetts",12,59.80,32.50,6.42],["Michigan",18,51.28,46.15,1.99],["Minnesota",10,47.91,45.50,5.20],["Mississippi",7,40.70,57.62,0.82],["Missouri",11,47.08,50.42,1.63],["Montana",3,33.36,58.44,5.95],["Nebraska",5,33.25,62.25,3.52],["Nevada",4,45.98,49.52,2.46],["New Hampshire",4,46.80,48.07,3.90],["New Jersey",15,56.13,40.29,2.97],["New Mexico",5,47.91,47.85,3.55],["New York",33,60.21,35.23,3.58],["North Carolina",14,43.20,56.03,0.00],["North Dakota",3,33.06,60.66,3.29],["Ohio",21,46.46,49.97,2.50],["Oklahoma",8,38.43,60.31,0.00],["Oregon",7,46.96,46.52,5.04],["Pennsylvania",23,50.60,46.43,2.10],["Rhode Island",4,60.99,31.91,6.12],["South Carolina",8,40.90,56.84,1.46],["South Dakota",3,37.56,60.30,0.00],["Tennessee",11,47.28,51.15,0.95],["Texas",32,37.98,59.30,2.15],["Utah",5,26.34,66.83,4.65],["Vermont",3,50.63,40.70,6.92],["Virginia",13,44.44,52.47,2.17],["Washington",11,50.16,44.58,4.14],["West Virginia",5,45.59,51.92,1.65],["Wisconsin",11,47.83,47.61,3.62],["Wyoming",3,27.70,67.76,2.12]];

// 2012 Election - Libertarian
var stateInfo2012 = [["Alabama",9,38.36,60.55,0.59],["Alaska",3,40.81,54.80,2.46],["Arizona",11,44.59,53.65,1.40],["Arkansas",6,36.88,60.57,1.52],["California",55,60.24,37.12,1.10],["Colorado",9,51.49,46.13,1.38],["Connecticut",7,58.06,40.73,0.81],["Delaware",3,58.61,39.98,0.94],["D.C.",3,90.91,7.28,0.71],["Florida",29,50.01,49.13,0.53],["Georgia",16,45.48,53.30,1.16],["Hawaii",4,70.55,27.84,0.88],["Idaho",4,32.62,64.53,1.45],["Illinois",20,57.60,40.73,1.07],["Indiana",11,43.93,54.13,1.91],["Iowa",6,51.99,46.18,0.82],["Kansas",6,37.99,59.71,1.76],["Kentucky",8,37.80,60.49,0.95],["Louisiana",8,40.58,57.78,0.91],["Maine (at-large)",1,56.27,40.98,1.31],["Maine, 1st",1,59.57,38.18,1.20],["Maine, 2nd",2,52.94,44.38,1.44],["Maryland",10,61.97,35.90,1.12],["Massachusetts",11,60.65,37.51,0.98],["Michigan",16,54.21,44.71,0.16],["Minnesota",10,52.65,44.96,1.20],["Mississippi",6,43.79,55.29,0.52],["Missouri",10,44.38,53.76,1.56],["Montana",3,41.70,55.35,2.93],["Nebraska (at-large)",1,38.03,59.80,1.40],["Nebraska, 1st",1,40.95,57.59,1.46],["Nebraska, 2nd",1,45.78,52.95,1.27],["Nebraska, 3rd",2,27.94,70.56,1.50],["Nevada",6,52.36,45.68,1.08],["New Hampshire",4,51.98,46.40,1.16],["New Jersey",14,58.38,40.59,0.58],["New Mexico",5,52.99,42.84,3.55],["New York",29,63.35,35.17,0.67],["North Carolina",15,48.35,50.39,0.99],["North Dakota",3,38.69,58.32,1.62],["Ohio",18,50.67,47.69,0.89],["Oklahoma",7,33.23,66.77,0.00],["Oregon",7,54.24,42.15,1.35],["Pennsylvania",20,51.97,46.59,0.87],["Rhode Island",4,62.70,35.24,0.98],["South Carolina",9,44.09,54.56,0.83],["South Dakota",3,39.87,57.89,1.59],["Tennessee",11,39.08,59.48,0.76],["Texas",38,41.38,57.17,1.11],["Utah",6,24.75,72.79,1.24],["Vermont",3,66.57,30.97,1.17],["Virginia",13,51.16,47.28,0.81],["Washington",12,56.16,41.29,1.35],["West Virginia",5,35.54,62.30,0.94],["Wisconsin",10,52.83,45.89,0.67],["Wyoming",3,27.82,68.64,2.14]];

// 2016 Election - Green
var stateInfo2016G = [["Alabama",9,36.2,57.1,1.8],["Alaska",3,40,47.8,1.7],["Arizona",11,45.2,45.8,1.3],["Arkansas",6,38.2,54.9,1.8],["California",55,58.2,34.6,1.6],["Colorado",9,47.7,41.9,1.3],["Connecticut",7,53.9,38.4,1.5],["D.C.",3,76.6,14.6,3],["Delaware",3,54.1,37.8,1.5],["Florida",29,48.2,45.5,1.3],["Georgia",16,44.7,48.5,0],["Hawaii",4,63.1,29.6,2],["Idaho",4,33.6,54.7,2],["Illinois",20,54.6,38.7,1.3],["Indiana",11,41.4,49.4,0],["Iowa",6,45.8,45.3,1.3],["Kansas",6,40.3,49.8,1.8],["Kentucky",8,39.7,53.5,1.8],["Louisiana",8,40.3,52.3,1.6],["Maine - 1st District",1,54.1,35.6,1.6],["Maine - 2nd District",1,43.8,45.7,1.3],["Maine - Statewide",2,49.2,40.4,1.4],["Maryland",10,60.9,32.3,1.7],["Massachusetts",11,56.8,34.4,1.6],["Michigan",16,49.4,42.2,1.3],["Minnesota",10,49.6,42.7,1.2],["Mississippi",6,41.5,53.4,1.6],["Missouri",10,42.9,48.7,1.5],["Montana",3,39.6,48.7,1.6],["Nebraska - 1st District",1,38.2,52.2,1.6],["Nebraska - 2nd District",1,45,46.2,1.5],["Nebraska - 3rd District",1,27.3,62,2.1],["Nebraska - Statewide",2,36.9,53.4,1.7],["Nevada",6,47.3,44.3,1.3],["New Hampshire",4,48.1,41.8,1.2],["New Jersey",14,53.4,40.7,1.4],["New Mexico",5,46.8,36,1.3],["New York",29,56.6,36.5,1.6],["North Carolina",15,47.7,45.8,0],["North Dakota",3,36.7,52.3,1.7],["Ohio",18,46.4,45.5,1.2],["Oklahoma",7,36.3,56.3,0],["Oregon",7,52.4,39,1.4],["Pennsylvania",20,49.3,43.4,1.3],["Rhode Island",4,55.4,36.9,1.7],["South Carolina",9,43.4,50.3,1.5],["South Dakota",3,39.6,50.1,1.6],["Tennessee",11,39.9,52.7,1.7],["Texas",38,42.5,49.5,1.6],["Utah",6,35.6,50.7,2.2],["Vermont",3,58,32.7,1.8],["Virginia",13,49.2,41.7,1.2],["Washington",12,52,38.1,1.4],["West Virginia",5,34.9,57,1.9],["Wisconsin",10,48.8,42,1.3],["Wyoming",3,29,59.3,2.1]];

// 2016 Election - Libertarian
var stateInfo2016L = [["Alabama",9,36.9,56.8,4.5],["Alaska",3,41.8,46,10.6],["Arizona",11,46.2,45.5,6.9],["Arkansas",6,39.1,54,5],["California",55,59.3,33.9,5.2],["Colorado",9,49.2,41,8.6],["Connecticut",7,55.2,37.6,5.7],["D.C.",3,77.3,14.7,5],["Delaware",3,54.8,38,5.8],["Florida",29,49.3,45.1,4.3],["Georgia",16,45.7,48.3,6],["Hawaii",4,63.5,29.5,4.9],["Idaho",4,35.6,53.6,8.9],["Illinois",20,55.4,38.3,5],["Indiana",11,42.6,48.7,8.7],["Iowa",6,46.6,45.2,6.9],["Kansas",6,42.1,48.9,7.3],["Kentucky",8,40.9,52.2,5.2],["Louisiana",8,40.7,52.6,5],["Maine - 1st District",1,55.7,35.1,7.6],["Maine - 2nd District",1,45.1,44.4,9.1],["Maine - Statewide",2,50.7,39.5,8.3],["Maryland",10,61.3,32.3,4.8],["Massachusetts",11,58.1,33.3,7],["Michigan",16,50.4,41.3,7],["Minnesota",10,50.3,42.7,5.8],["Mississippi",6,41.5,53.4,3.5],["Missouri",10,44.3,48.4,5.9],["Montana",3,39.3,48.5,10.7],["Nebraska - 1st District",1,39,51.9,7.5],["Nebraska - 2nd District",1,45.8,45.8,7],["Nebraska - 3rd District",1,28.2,61.8,7.9],["Nebraska - Statewide",2,37.7,53.1,7.5],["Nevada",6,48.2,43.9,6.6],["New Hampshire",4,49.6,41,8.2],["New Jersey",14,54.3,39.9,4.3],["New Mexico",5,47.8,36.3,14.5],["New York",29,58,35.5,4.8],["North Carolina",15,48.8,45.3,5.8],["North Dakota",3,37.3,52.5,8.5],["Ohio",18,47.3,45.2,6.3],["Oklahoma",7,37.7,55.9,6.3],["Oregon",7,52.3,40,6.3],["Pennsylvania",20,50.6,42.9,5.3],["Rhode Island",4,57.4,35.6,5.3],["South Carolina",9,44.1,50.2,4.3],["South Dakota",3,40.3,49.9,8.2],["Tennessee",11,40.7,52.4,5.3],["Texas",38,43.7,49.5,5.1],["Utah",6,28.9,37.5,9.2],["Vermont",3,60.6,30.4,7.2],["Virginia",13,50.9,41,6.9],["Washington",12,52.6,38.1,7.9],["West Virginia",5,35.9,57,5.3],["Wisconsin",10,50.4,42.2,6.1],["Wyoming",3,29.3,59.2,9.4]];

// 2016 Election - McMullin
var stateInfo2016M = [["Alabama",9,36.9,56.8,0],["Alaska",3,41.8,46,0],["Arizona",11,46.2,45.5,0],["Arkansas",6,39.1,54,1.9],["California",55,59.3,33.9,-100],["Colorado",9,49.2,41,1.2],["Connecticut",7,55.2,37.6,-100],["D.C.",3,77.3,14.7,-100],["Delaware",3,54.8,38,0],["Florida",29,49.3,45.1,-100],["Georgia",16,45.7,48.3,0],["Hawaii",4,63.5,29.5,0],["Idaho",4,35.6,53.6,1.9],["Illinois",20,55.4,38.3,0],["Indiana",11,42.6,48.7,-100],["Iowa",6,46.6,45.2,1.3],["Kansas",6,42.1,48.9,-100],["Kentucky",8,40.9,52.2,1.7],["Louisiana",8,40.7,52.6,1.7],["Maine - 1st District",1,55.7,35.1,0],["Maine - 2nd District",1,45.1,44.4,0],["Maine - Statewide",2,50.7,39.5,0],["Maryland",10,61.3,32.3,0],["Massachusetts",11,58.1,33.3,0],["Michigan",16,50.4,41.3,0],["Minnesota",10,50.3,42.7,1.2],["Mississippi",6,41.5,53.4,-100],["Missouri",10,44.3,48.4,-100],["Montana",3,39.3,48.5,0],["Nebraska - 1st District",1,39,51.9,0],["Nebraska - 2nd District",1,45.8,45.8,0],["Nebraska - 3rd District",1,28.2,61.8,0],["Nebraska - Statewide",2,37.7,53.1,0],["Nevada",6,48.2,43.9,-100],["New Hampshire",4,49.6,41,0],["New Jersey",14,54.3,39.9,0],["New Mexico",5,47.8,36.3,1.4],["New York",29,58,35.5,-100],["North Carolina",15,48.8,45.3,-100],["North Dakota",3,37.3,52.5,1.7],["Ohio",18,47.3,45.2,0],["Oklahoma",7,37.7,55.9,-100],["Oregon",7,52.3,40,0],["Pennsylvania",20,50.6,42.9,0],["Rhode Island",4,57.4,35.6,1.7],["South Carolina",9,44.1,50.2,0],["South Dakota",3,40.3,49.9,-10],["Tennessee",11,40.7,52.4,1.6],["Texas",38,43.7,49.5,0],["Utah",6,28.9,37.5,22.2],["Vermont",3,60.6,30.4,0],["Virginia",13,50.9,41,2],["Washington",12,52.6,38.1,-100],["West Virginia",5,35.9,57,0],["Wisconsin",10,50.4,42.2,0],["Wyoming",3,29.3,59.2,-100]];

var loopMasterCount = 100000;
var state_info = [];
var firstPartyStdDev;
var thirdPartyStdDev;
var stateErrorMax; 
var nationalErrorMax; 
var thirdPartyLean; // -1 (fully conservative) to 1 (fully liberal)
var electionName = "";
var demCandidate = "";
var repCandidate = "";
var thirdCandidate = "";

partyEnum = {
    DEM : 0,
    REP : 1,
    THIRD : 2
}

function setupElection(electionDate){

    var selectElection = document.getElementById("election_dropdown");
    var electionYear = selectElection.options[selectElection.selectedIndex].value;

    firstPartyStdDev = 2.0;
    thirdPartyStdDev = 2.0;
    stateErrorMax = 5.0; 
    nationalErrorMax = 0.5; 

    if(electionYear == 1912){
        electionName = "1912 Election. 3rd party: Progressive";
        demCandidate = "Woodrow Wilson";
        repCandidate = "William Taft";
        thirdCandidate = "Theodore Roosevelt";
        state_info = stateInfo1912.slice(0);
        firstPartyStdDev = 3.5;
        thirdPartyStdDev = 3.5;
        thirdPartyLean = -0.82;
    }else if(electionYear == 1968){
        electionName = "1968 Election. 3rd party: American Independent";
        demCandidate = "Hubert Humphrey";
        repCandidate = "Richard Nixon";
        thirdCandidate = "George Wallace";
        state_info = stateInfo1968.slice(0);
        thirdPartyLean = -0.31;
    }else if(electionYear == 1980){
        electionName = "1980 Election. 3rd party: Independent";
        demCandidate = "Walter Mondale";
        repCandidate = "Ronald Reagan";
        thirdCandidate = "John Anderson";
        state_info = stateInfo1980.slice(0);
        thirdPartyLean = 0.09;
    }else if(electionYear == 1992){
        electionName = "1992 Election. 3rd party: Independent";
        demCandidate = "Bill Clinton";
        repCandidate = "George H.W. Bush";
        thirdCandidate = "Ross Perot";
        state_info = stateInfo1992.slice(0); 
        thirdPartyLean = -0.07;
    }else if(electionYear == 2000){
        electionName = "2000 Election. 3rd party: Green";
        demCandidate = "Al Gore";
        repCandidate = "George W. Bush";
        thirdCandidate = "Ralph Nader";
        state_info = stateInfo2000.slice(0);
        nationalErrorMax = 0.0; 
        thirdPartyLean = 0.26;
    }else if(electionYear == 2012){
        electionName = "2012 Election. 3rd party: Libertarian";
        demCandidate = "Barack Obama";
        repCandidate = "Mitt Romney";
        thirdCandidate = "Gary Johnson";
        state_info = stateInfo2012.slice(0);
        nationalErrorMax = 0.0; 
        thirdPartyLean = 0.05;
    }else if(electionYear == 2016.0){
        electionName = "2016 Election. 3rd party: Libertarian";
        demCandidate = "Hillary Clinton";
        repCandidate = "Donald Trump";
        thirdCandidate = "Gary Johnson";
        state_info = stateInfo2016L.slice(0);
        firstPartyStdDev = 4.5;
        thirdPartyStdDev = 4.5;
        stateErrorMax = -1.0;
        nationalErrorMax = 3.3; 
        thirdPartyLean = 0.10; 
    }else if(electionYear == 2016.1){
        electionName = "2016 Election. 3rd party: Green";
        demCandidate = "Hillary Clinton";
        repCandidate = "Donald Trump";
        thirdCandidate = "Jill Stein";
        state_info = stateInfo2016G.slice(0);
        firstPartyStdDev = 4.5;
        stateErrorMax = -1.0;
        nationalErrorMax = 3.3; 
        thirdPartyLean = 0.33; 
    }else if(electionYear == 2016.2){
        electionName = "2016 Election. 3rd party: Independent";
        demCandidate = "Hillary Clinton";
        repCandidate = "Donald Trump";
        thirdCandidate = "Evan McMillan";
        state_info = stateInfo2016M.slice(0);
        firstPartyStdDev = 4.5;
        thirdPartyStdDev = 4.5;
        stateErrorMax = -1.0;
        nationalErrorMax = 3.3; 
        thirdPartyLean = -0.21; 
    }
    
}

// returns a gaussian random function with the given mean and stdev.
function gaussian(mean, stdev) {
    var y2;
    var use_last = false;
    return function() {
        var y1;
        if(use_last) {
           y1 = y2;
           use_last = false;
        }
        else {
            var x1, x2, w;
            do {
                 x1 = 2.0 * Math.random() - 1.0;
                 x2 = 2.0 * Math.random() - 1.0;
                 w  = x1 * x1 + x2 * x2;               
            } while( w >= 1.0);
            w = Math.sqrt((-2.0 * Math.log(w))/w);
            y1 = x1 * w;
            y2 = x2 * w;
            use_last = true;
       }

       var retval = mean + stdev * y1;

       return retval;
   }
}

function formatOdds(label, count, loops){
    var percentage = (count / loops) * 100;
    formatted = label + ": " + percentage.toFixed(2) + "% ";
    return formatted;
}

var stateWidth = 100;
var valueWidth = 80;

function valueCellText(width, value){
    return "<td style='width: " + width + "px; text-align: right;'>" + value + "</td>";
}

function tableRowDashes(){
    var myRow = "<tr>";
    myRow += valueCellText(stateWidth, "-------------");
    myRow += valueCellText(valueWidth, "-------------");
    myRow += valueCellText(valueWidth, "-------------");
    myRow += valueCellText(valueWidth, "-------------");
    myRow += valueCellText(valueWidth, "-------------");
    myRow += valueCellText(valueWidth, "-------------");
    myRow += "</tr>";
    return myRow;
}



function NationLooper(loopCount){

    // Size these arrays for counting state victories.
    var demStatesWins = [];
    var repStatesWins = [];
    var thirdStatesWins = [];
    var spoilerStatesTotal = [];
    
    // Initialize counts of dem-wins, rep-wins, 3rd-wins and spoilers by state
    var electoralTotal = 0;
    for(var i = 0; i < state_info.length; i++){
        demStatesWins.push(0);
        repStatesWins.push(0);
        thirdStatesWins.push(0);
        spoilerStatesTotal.push(0);
        electoralTotal += state_info[i][1];
    }
    var halfElectoral = electoralTotal / 2.0;
    
    var demNationWins = 0;
    var repNationWins = 0;
    var thirdNationWins = 0;
    var spoilerCount = 0;
    var electionFail = 0;
    
    for(var i = 0; i < loopCount; i++){
        // Generate a national error factor
        var nationError = nationalErrorMax * ((2.0 * Math.random()) - 1.0);
        
        // Vary the state error max if the user has set one.
        if(stateErrorMax > 0.0){
            firstPartyStdDev = stateErrorMax * Math.random();
            thirdPartyStdDev = stateErrorMax * Math.random();
        }
    
        var demElectoral = 0;
        var repElectoral = 0;
        var thirdElectoral = 0;
        
        var demElectoralAdj = 0;
        var repElectoralAdj = 0;
        
        var demStates = [];
        var repStates = [];
        var thirdStates = [];
        var spoilerStates = [];
        
        for(var j = 0; j < state_info.length; j++){
        
            var demGen = gaussian(state_info[j][2], firstPartyStdDev);
            var repGen = gaussian(state_info[j][3], firstPartyStdDev);
            var thirdGen = gaussian(state_info[j][4], thirdPartyStdDev);
            
            // Determine the popular vote recieved by each candidate in a 3-party race
            var demValue = demGen() + nationError;
            var repValue = repGen() - nationError;
            var thirdValue = thirdGen();
            
            // Determine the popular vote recieved by each candidate in a 2-party race
            var demValueAdj = demValue;
            var repValueAdj = repValue;
            if(thirdValue > 0){
                if(thirdPartyLean > 0){
                    demValueAdj += (thirdValue * thirdPartyLean);
                }else if(thirdPartyLean < 0){
                    repValueAdj += (thirdValue * -thirdPartyLean);
                } 
            }
            
            var electoralsAtStake = state_info[j][1];
    
            // Outcome of 3-party state race
            if(thirdValue > demValue && thirdValue > repValue){
                // Third party wins state in 3-party race
                thirdElectoral += electoralsAtStake;
                thirdStatesWins[j]++;
                
            }else if(demValue > repValue){
                // Democrats win state in 3-party race
                demElectoral += electoralsAtStake;
                demStatesWins[j]++;
                
                if(repValueAdj > demValueAdj){
                    // But republicans would have won the state in a 2-party race
                    spoilerStates.push(j);
                }
            }else{
                // Republicans win state in 3-party race
                repElectoral += electoralsAtStake;
                repStatesWins[j]++;
                
                if(demValueAdj > repValueAdj){
                    // But democrats would have won the state in a 2-party race
                    spoilerStates.push(j);
                }
            }
            
            // Outcome of 2-party state race
            if(demValueAdj > repValueAdj){
                // Democrats win state in a 2-party race
                demElectoralAdj += electoralsAtStake;
            }else{
                // Republicans state win in a 2-party race
                repElectoralAdj += electoralsAtStake;
            }
        } // End of state loop
        
        // Outcome of 3-party nation race
        if(thirdElectoral > demElectoral && thirdElectoral > repElectoral){
            // Third party wins nation in 3-party race!
            thirdNationWins++;
        }else if(demElectoral > repElectoral){
            // Democrats win nation in 3-party race
            demNationWins++;
            
            if(repElectoralAdj > demElectoralAdj){
                // But Republicans would have won in a 2-party race. Conservative 3rd party spoiler!
                spoilerCount++;
                for(var k = 0; k < spoilerStates.length; k++){
                    spoilerStatesTotal[spoilerStates[k]]++;
                }
            }
        }else{
            // Republicans win nation in 3-party race
            repNationWins++;
            
            if(demElectoralAdj > repElectoralAdj){
                // But Democrats would have won in a 2-party race. Liberal 3rd party spoiler!
                spoilerCount++;
                for(var k = 0; k < spoilerStates.length; k++){
                    spoilerStatesTotal[spoilerStates[k]]++;
                }
            }
        }
        
        if(demElectoral < halfElectoral && repElectoral < halfElectoral && thirdElectoral < halfElectoral){
            electionFail++;
        }
    } // End of nation loop
    
    
    
    // Output results in a table
    var myTable = electionName + "<br/>";
    myTable += demCandidate + " vs " + repCandidate + " vs " + thirdCandidate + "<br/>";
    myTable += "Third party voters lean ";
    var leanPercentage;
    if(thirdPartyLean < 0){
        myTable += " conservative ";
        leanPercentage = -thirdPartyLean * 100;
    }else{
        myTable += " liberal ";
        leanPercentage = thirdPartyLean * 100;
    }
    myTable += "by about " + leanPercentage.toFixed(0) + "%<br/>";
    myTable += "Number of simulations : " + loopCount + "<br/>";

    var failPercentage = (electionFail / loopCount) * 100;
    myTable += "Odds of a deadlock (no party gets half the electoral): " + failPercentage.toFixed(3) + "%<br/>";
    
    // Output header
    myTable += "<br/>";
    myTable += "<table><tr><td style='width: " + stateWidth + "px; color: red;'>State</td>";
    myTable += "<td style='width: " + valueWidth + "px; color: red; text-align: right;'>Dem Win %</td>";
    myTable += "<td style='width: " + valueWidth + "px; color: red; text-align: right;'>Rep Win %</td>";
    myTable += "<td style='width: " + valueWidth + "px; color: red; text-align: right;'>3rd Win %</td>";
    myTable += "<td style='width: " + valueWidth + "px; color: red; text-align: right;'>Spoiler %</td>";
    myTable += "<td style='width: " + valueWidth + "px; color: red; text-align: right;'>Sp Share %</td></tr>";

    myTable += tableRowDashes();

    // Output nation results
    var demWinPercentage = (demNationWins / loopCount) * 100;
    var repWinPercentage = (repNationWins / loopCount) * 100;
    var thirdWinPercentage = (thirdNationWins / loopCount) * 100;
    var spoilChance = (spoilerCount / loopCount) * 100;
        
    myTable += "<tr>";
    myTable += valueCellText(stateWidth, "Nation:");
    myTable += valueCellText(valueWidth, demWinPercentage.toFixed(2));
    myTable += valueCellText(valueWidth, repWinPercentage.toFixed(2));
    myTable += valueCellText(valueWidth, thirdWinPercentage.toFixed(2));
    myTable += valueCellText(valueWidth, spoilChance.toFixed(2));
    myTable += valueCellText(valueWidth, "X");
    myTable += "</tr>";
    
    myTable += tableRowDashes();
    
    // Output state results
    for(var i = 0; i < state_info.length; i++){
        var demStateWinPercentage = (demStatesWins[i] / loopCount) * 100;
        var repStateWinPercentage = (repStatesWins[i] / loopCount) * 100;
        var thirdStateWinPercentage = (thirdStatesWins[i] / loopCount) * 100;
        var spoilerStatePercentage = (spoilerStatesTotal[i] / loopCount) * 100;
        var relativeShare = (spoilerStatesTotal[i] / spoilerCount) * 100;
        
        myTable += "<tr>";
        myTable += valueCellText(stateWidth, state_info[i][0] + " (" + state_info[i][1] + "):");
        myTable += valueCellText(valueWidth, demStateWinPercentage.toFixed(1));
        myTable += valueCellText(valueWidth, repStateWinPercentage.toFixed(1));
        myTable += valueCellText(valueWidth, thirdStateWinPercentage.toFixed(1));
        myTable += valueCellText(valueWidth, spoilerStatePercentage.toFixed(3));
        myTable += valueCellText(valueWidth, relativeShare.toFixed(1));
        myTable += "</tr>";
    }
    myTable += "</table>";
    
    return myTable;
}

function NationButton(){

    myTable = NationLooper(loopMasterCount);
    //myTable = NationDeadlocker(loopMasterCount);
    
    document.getElementById("card1").innerHTML = myTable;
}
